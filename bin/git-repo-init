#!/usr/bin/env bash

cd "$(git root)" || exit 1

if [ -f .mise.toml ] && [ -n "$MISE_TRUST_REPO" ];then
  github_user=$(git remote get-url origin | awk -F'[:/]' '{printf "%s\n", $(NF-1)}')
  if [ -n "$github_user" ] && echo " $MISE_TRUST_REPO " | grep -q "$github_user";then
    mise trust
  fi
fi

if type uv >& /dev/null && [ -f uv.lock ];then
  uv sync
fi

if [ -f .pre-commit-config.yaml ] && [ ! -x "$(git rev-parse --git-path hooks/pre-commit)" ];then
  if [ -f uv.lock ] && type uv >&/dev/null && uv run which pre-commit >&/dev/null;then
    uv run pre-commit install
  elif type p-re-commit >& /dev/null;then
    pre-commit install
  fi
fi
